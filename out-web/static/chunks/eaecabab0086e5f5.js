(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,56036,e=>{"use strict";var r=e.i(43476),t=e.i(71645),l=e.i(88545);function n(){let e=(0,l.isTauriEnvironment)(),[n,o]=(0,t.useState)(""),{messages:a,sendMessage:s,status:i,error:d}=function(e={}){let{initialMessages:r=[],onToolCall:n,config:o={}}=e,[a,s]=(0,t.useState)(r),[i,d]=(0,t.useState)("idle"),[c,u]=(0,t.useState)(null),p=(0,t.useRef)(null),x=(0,t.useRef)(new Map),h=(0,t.useRef)(null),g=(0,t.useRef)(!1),m=(0,t.useCallback)(async e=>{if(!g.current)switch(e.type){case"start":p.current={id:`assistant-${Date.now()}`,content:"",parts:[]},x.current.clear();break;case"text_delta":p.current&&e.delta&&(p.current.content+=e.delta,s(e=>{let r=[...e],t=r[r.length-1];if(t?.id===p.current?.id)t.content=p.current.content,t.parts=p.current.parts;else{let e=p.current;e&&r.push({id:e.id,role:"assistant",content:e.content,parts:e.parts})}return r}));break;case"tool_call_start":e.tool_call_id&&e.tool_name&&(x.current.set(e.tool_call_id,{toolCallId:e.tool_call_id,toolName:e.tool_name,input:"",isComplete:!1}),p.current&&p.current.parts.push({type:"tool-call",toolCallId:e.tool_call_id,toolName:e.tool_name,state:"partial-call"}));break;case"tool_input_delta":if(e.tool_call_id&&e.delta){let r=x.current.get(e.tool_call_id);r&&(r.input+=e.delta)}break;case"tool_input_complete":if(e.tool_call_id&&e.tool_name&&e.input){let r=x.current.get(e.tool_call_id);if(r&&(r.isComplete=!0),p.current){let r=p.current.parts.findIndex(r=>r.toolCallId===e.tool_call_id);-1!==r&&(p.current.parts[r]={type:"tool-call",toolCallId:e.tool_call_id,toolName:e.tool_name,input:e.input,state:"call"},s(e=>{let r=[...e],t=r[r.length-1];return t?.id===p.current?.id&&(t.parts=p.current.parts),r}))}if(n)try{let r=await n({toolCall:{toolCallId:e.tool_call_id,toolName:e.tool_name,input:e.input}});if(p.current){let t=p.current.parts.findIndex(r=>r.toolCallId===e.tool_call_id);-1!==t&&(p.current.parts[t].state="result",p.current.parts[t].output=r||"success",s(e=>{let r=[...e],t=r[r.length-1];return t?.id===p.current?.id&&(t.parts=p.current.parts),r}))}}catch(r){if(console.error("[useTauriChat] Tool call error:",r),p.current){let t=p.current.parts.findIndex(r=>r.toolCallId===e.tool_call_id);-1!==t&&(p.current.parts[t].state="output-error",p.current.parts[t].error=r instanceof Error?r.message:String(r),s(e=>{let r=[...e],t=r[r.length-1];return t?.id===p.current?.id&&(t.parts=p.current.parts),r}))}}}break;case"finish":d("idle"),p.current=null;break;case"error":u(Error(e.error||"Unknown error")),d("error"),p.current=null}},[n]);(0,t.useEffect)(()=>{if(!(0,l.isTauriEnvironment)())return;let e=(0,l.getTauriAPI)();return e?.event?.listen?(e.event.listen("chat-stream",e=>{m(e.payload)}).then(e=>{h.current=e}),()=>{h.current&&(h.current(),h.current=null)}):void console.error("[useTauriChat] Tauri event API not available")},[m]);let f=(0,t.useCallback)(async(e,r={})=>{let t;if(!(0,l.isTauriEnvironment)())throw Error("Not in Tauri environment");let n=(0,l.getTauriAPI)();if(!n?.invoke)throw Error("Tauri invoke API not available");g.current=!1,t="string"==typeof e?e:e.parts.filter(e=>"text"===e.type&&e.text).map(e=>e.text).join("\n");let o={id:`user-${Date.now()}`,role:"user",content:t};s(e=>[...e,o]),d("loading"),u(null);try{let e={messages:[...a.map(e=>({role:e.role,parts:[{text:e.content}]})),{role:"user",parts:[{text:t}]}],xml:r.body?.xml,previous_xml:r.body?.previousXml,access_code:r.headers?.["x-access-code"],session_id:r.body?.sessionId},l=r.headers?.["x-ai-provider"],o=r.headers?.["x-ai-model"],s=r.headers?.["x-ai-api-key"],i=r.headers?.["x-ai-base-url"],d=r.headers?.["x-minimal-style"]==="true";await n.invoke("chat_stream",{payload:JSON.stringify(e),providerOverride:l||null,modelOverride:o||null,apiKeyOverride:s||null,baseUrlOverride:i||null,minimalStyle:d||!1})}catch(r){let e=r instanceof Error?r:Error(String(r));throw u(e),d("error"),e}},[a,o]);return{messages:a,sendMessage:f,addToolOutput:(0,t.useCallback)(e=>{s(r=>{let t=[...r],l=t[t.length-1];if(l?.role==="assistant"&&l.parts){let r=l.parts.findIndex(r=>r.toolCallId===e.toolCallId);-1!==r&&(l.parts[r].state="result",l.parts[r].output=e.output)}return t})},[]),stop:(0,t.useCallback)(()=>{g.current=!0,d("idle"),p.current=null},[]),status:i,error:c,setMessages:s}}({onToolCall:async({toolCall:e})=>(console.log("[Test] Tool call:",e.toolName,e.input),"Tool output received")}),c=async e=>{if(e.preventDefault(),n.trim())try{await s({parts:[{type:"text",text:n}]},{body:{},headers:{}}),o("")}catch(e){console.error("[Test] Send message error:",e)}};return e?(0,r.jsxs)("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto"},children:[(0,r.jsx)("h1",{children:"Tauri Chat Test"}),(0,r.jsx)("p",{style:{color:"green"},children:"✓ Running in Tauri environment"}),(0,r.jsxs)("div",{style:{border:"1px solid #ccc",borderRadius:"8px",padding:"16px",marginBottom:"20px",maxHeight:"400px",overflowY:"auto",background:"#f9f9f9"},children:[(0,r.jsx)("h3",{children:"Messages:"}),0===a.length?(0,r.jsx)("p",{style:{color:"#999"},children:"No messages yet. Try sending one!"}):a.map(e=>(0,r.jsxs)("div",{style:{padding:"10px",marginBottom:"10px",background:"user"===e.role?"#e3f2fd":"#fff",borderRadius:"4px",border:"1px solid #ddd"},children:[(0,r.jsxs)("strong",{children:[e.role,":"]})," ",e.content,e.parts&&e.parts.length>0&&(0,r.jsxs)("div",{style:{marginTop:"8px",fontSize:"0.9em"},children:[(0,r.jsx)("strong",{children:"Parts:"}),e.parts.map((e,t)=>(0,r.jsxs)("div",{style:{marginLeft:"10px"},children:["- ",e.type,e.toolName&&`: ${e.toolName}`]},t))]})]},e.id))]}),d&&(0,r.jsxs)("div",{style:{padding:"16px",marginBottom:"20px",background:"#ffebee",border:"1px solid #f44336",borderRadius:"8px",color:"#c62828"},children:[(0,r.jsx)("strong",{children:"Error:"})," ",d.message]}),(0,r.jsxs)("form",{onSubmit:c,style:{display:"flex",gap:"10px"},children:[(0,r.jsx)("input",{type:"text",value:n,onChange:e=>o(e.target.value),placeholder:"Type a message...",disabled:"loading"===i,style:{flex:1,padding:"12px",fontSize:"16px",border:"1px solid #ccc",borderRadius:"4px"}}),(0,r.jsx)("button",{type:"submit",disabled:"loading"===i||!n.trim(),style:{padding:"12px 24px",fontSize:"16px",background:"loading"===i?"#ccc":"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"loading"!==i&&n.trim()?"pointer":"not-allowed"},children:"loading"===i?"Sending...":"Send"})]}),(0,r.jsxs)("div",{style:{marginTop:"20px",padding:"16px",background:"#f5f5f5",borderRadius:"8px"},children:[(0,r.jsx)("h3",{children:"Status:"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",i]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Message Count:"})," ",a.length]})]}),(0,r.jsxs)("div",{style:{marginTop:"20px",padding:"16px",background:"#fff3cd",borderRadius:"8px"},children:[(0,r.jsx)("h3",{children:"Instructions:"}),(0,r.jsxs)("ol",{children:[(0,r.jsxs)("li",{children:["Make sure you have configured AI provider in ",(0,r.jsx)("code",{children:".env"})]}),(0,r.jsx)("li",{children:'Try sending a simple message like "Hello"'}),(0,r.jsx)("li",{children:'Try asking for a diagram: "Create a simple flowchart"'}),(0,r.jsx)("li",{children:"Check browser console for detailed logs"})]})]})]}):(0,r.jsxs)("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto"},children:[(0,r.jsx)("h1",{children:"Tauri Chat Test"}),(0,r.jsx)("p",{style:{color:"red"},children:"⚠️ Not running in Tauri environment. This test page only works in Tauri desktop app."}),(0,r.jsxs)("p",{children:["To test:",(0,r.jsx)("code",{style:{display:"block",padding:"10px",background:"#f5f5f5",margin:"10px 0"},children:"npm run tauri:dev"})]})]})}e.s(["default",()=>n],56036)}]);